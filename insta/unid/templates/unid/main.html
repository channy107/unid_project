{% extends 'unid/navigationbar.html' %}
{% load static %}
{% block content %}
<head>
    <link href="{% static 'unid/css/main.css' %}" rel="stylesheet">
    <link href="{% static 'unid/css/mywallet.css' %}" rel="stylesheet">

<div class="container">
<div class="row">

        <div class="sidenav">

          <h4 class="my-4">태그 카테고리</h4>
          <div class="list-group">
            <a href="#" class="list-group-item">#학교정보</a>
            <a href="#" class="list-group-item">#학교주변리뷰</a>
            <a href="#" class="list-group-item">#취업정보</a>
            <a href="#" class="list-group-item">#질문</a>
          </div>

        </div>

        <div class="col-lg-9">
            <h5>인기글</h5>
            <div class="container">
                {% for info in post %}
                <hr>
                <div class="user">
                    <img src="/static/unid/icon/profle-icon.png" border="0" width="35" height="35">&nbsp
                    <span class="writer">{{ info.user_id }}</span>
                    <span class="writing-time">3일전</span>
                    <span class="contents-kind">{{ info.category }}</span>
                    </div>
                <div class="row">

                    <div class="main-col-md-3">
                        <a href="#">
                            <img class="img-fluid rounded mb-3 mb-md-0" src="http://placehold.it/200x200" alt="">
                        </a>
                    </div>
                <div class="col-md-5">

                    <div class="detail-content">
                        <h3>{{ info.title }}</h3>
                        <p>{{info.contents}}</p></div>
                            <!--<a class="btn btn-primary" href="#">View Project</a>-->

                    <div>
                        {% if user in unid.like_user_set.all%}
                        <span class="main-voting"><input type="image" class="like liked" name="{{ unid.id }}" src="{% static 'unid/icon/heart-icon.png' %}" border="0" width="18" height="18"><span class="like-count" id="count-{{ unid.id }}">좋아요 {{post.like_count}}개</span></span>
                        <span class="main-voting">
                        <input type="image" value="1" src="{% static 'unid/icon/dollar.png' %}" border="0" width="20" height="20"><span id="dallor1">0</span></span>
                        <span class="main-voting">
                        <img src="{% static 'unid/icon/wordballoon-icon.png' %}" border="0" width="20" height="20"></span>4

                {% endif %}
                    </div>

                </div>
                </div>

      <hr>
                {% endfor %}
        <div class="user">
                    <img src="/static/unid/icon/profle-icon.png" border="0" width="35" height="35">&nbsp
                    <span class="writer">작성자</span>
                    <span class="writing-time">3일전</span>
                    <span class="contents-kind">#학교정보</span>
                    </div>
                <div class="row">

                    <div class="main-col-md-3">
                        <a href="#">
                            <img class="img-fluid rounded mb-3 mb-md-0" src="http://placehold.it/200x200" alt="">
                        </a>
                    </div>
                <div class="col-md-5">

                    <div class="detail-content">
                        <h3>한양대 교양추천</h3>
                        <p>교양장인인 제가 생각했을때 가장 추천할만한 교양을 꼽자면 당연히 그거 죠
 그 교양 그 이름이 무엇이냐.....
유쾌한 이노베이션 정효찬 교수님
교양으로 듣는 논어와 맹자
인간과 음악적 상상력 정경성 교수님
혁신과 잡종의 과학사 남영 교수님 이네요..</p></div>
                            <!--<a class="btn btn-primary" href="#">View Project</a>-->
                    <div>
                        <span class="main-voting"><img src="{% static 'unid/icon/dollar.png' %}" border="0" width="18" height="18"></span>3.29
                        <span class="main-voting">
                        <img src="{% static 'unid/icon/heart-icon.png' %}" border="0" width="20" height="20"></span>10
                        <span class="main-voting">
                        <img src="{% static 'unid/icon/wordballoon-icon.png' %}" border="0" width="20" height="20"></span>4


                    </div>
                </div>
                </div>
            </div>
            <h5>최신글</h5>
            <div class="container">
                <hr>
                <div class="user">
                    <img src="/static/unid/icon/profle-icon.png" border="0" width="35" height="35">&nbsp
                    <span class="writer">작성자</span>
                    <span class="writing-time">3일전</span>
                    <span class="contents-kind">#학교정보</span>
                    </div>
                <div class="row">

                    <div class="main-col-md-3">
                        <a href="#">
                            <img class="img-fluid rounded mb-3 mb-md-0" src="http://placehold.it/200x200" alt="">
                        </a>
                    </div>
                <div class="col-md-5">

                    <div class="detail-content">
                        <h3>한양대 교양추천</h3>
                        <p>교양장인인 제가 생각했을때 가장 추천할만한 교양을 꼽자면 당연히 그거 죠
 그 교양 그 이름이 무엇이냐.....
유쾌한 이노베이션 정효찬 교수님
교양으로 듣는 논어와 맹자
인간과 음악적 상상력 정경성 교수님
혁신과 잡종의 과학사 남영 교수님 이네요..</p></div>
                            <!--<a class="btn btn-primary" href="#">View Project</a>-->
                    <div>
                        <span class="main-voting"><img src="{% static 'unid/icon/dollar.png' %}" border="0" width="18" height="18"></span>3.29
                        <span class="main-voting">
                        <img src="{% static 'unid/icon/heart-icon.png' %}" border="0" width="20" height="20"></span>10
                        <span class="main-voting">
                        <img src="{% static 'unid/icon/wordballoon-icon.png' %}" border="0" width="20" height="20"></span>4


                    </div>
                </div>
                </div>

      <hr>


    </div>

<script type="text/javascript">
$(document).on('click', '.like', function(){
    var pk = $(this).attr('name');
    $.ajax({ // .like 버튼을 클릭하면 <새로고침> 없이 ajax로 서버와 통신하겠다.
      type: "POST", // 데이터를 전송하는 방법을 지정
      url: "{% url 'unid:post_like' %}", // 통신할 url을 지정
      data: {'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터 전송시 옵션
      dataType: "json", // 서버측에서 전송한 데이터를 어떤 형식의 데이터로서 해석할 것인가를 지정, 없으면 알아서 판단
      // 서버측에서 전송한 Response 데이터 형식 (json)
      // {'likes_count': unid.like_count, 'message': message }
      success: function(response){ // 통신 성공시 - 좋아요 갯수 변경, 유저 목록 변경
        alert(response.message);
        $("#count-"+pk).html("좋아요 "+response.like_count+"개");
        var users = $("#like-user-"+pk).text();
        if(users.indexOf(response.nickname) != -1){
          if(response.like_count == 0){
            $("#like-user-"+pk).text("");
          }else{
          $("#like-user-"+pk).text(users.replace(response.nickname, ""));
          }
          $("input.like[name="+pk+"]").toggleClass('liked to-like');
        }else{
          $("#like-user-"+pk).text(response.nickname+users);
          $("input.like[name="+pk+"]").toggleClass('to-like liked');
        }
      },
      error: function(request, status, error){ // 통신 실패시 - 로그인 페이지 리다이렉트
        alert("로그인이 필요합니다.");
        window.location.replace("/accounts/login/");
        //  alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      },
    });
  });
  </script>
{% endblock %}